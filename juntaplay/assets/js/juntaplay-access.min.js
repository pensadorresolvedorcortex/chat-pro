!function($){"use strict";var i18n=window.wp&&window.wp.i18n?window.wp.i18n:null;function __(text){return i18n&&"function"==typeof i18n.__?i18n.__(text,"juntaplay"):text}function ajaxUrl(){return window.JuntaPlay&&window.JuntaPlay.ajax?window.JuntaPlay.ajax:"undefined"!=typeof window.ajaxurl?window.ajaxurl:""}function ajaxNonce(){return window.JuntaPlay&&window.JuntaPlay.nonce?window.JuntaPlay.nonce:""}function renderCredentials($card,payload){var $panel=$card.find("[data-group-access-panel]").first();if(!$panel.length)return;var $details=$panel.find("[data-group-access-details]").first(),$hint=$panel.find("[data-group-access-hint]").first(),fields=payload&&payload.credentials&&Array.isArray(payload.credentials)?payload.credentials:[],hintText=payload&&payload.hint?payload.hint.toString():"",hintHtml=payload&&payload.hint_html?payload.hint_html.toString():"";$details.length&&($details.empty(),fields.forEach(function(field){if(field&&"object"==typeof field){var label=field.label?field.label.toString():"",value=field.value?field.value.toString():"",htmlValue=field.html?field.html.toString():"";if(""!==label||""!==value){var $dt=$("<dt>",{class:"juntaplay-group-card__access-label"}).text(label),$dd=$("<dd>",{class:"juntaplay-group-card__access-value"});"url"===field.type&&""!==value?$dd.append($("<a>",{href:value,target:"_blank",rel:"noopener",text:value})):""!==htmlValue?$dd.html(htmlValue):$dd.text(value),$details.append($dt).append($dd)}}),fields.length>0?$details.removeAttr("hidden"):$details.attr("hidden","hidden")),$hint.length&&(hintHtml!==""?$hint.html(hintHtml).removeAttr("hidden"):(hintText=""===hintText&&0===fields.length?__("O administrador ainda não cadastrou os dados de acesso deste grupo."):""===hintText?__("As credenciais foram atualizadas para este grupo."):hintText,$hint.text(hintText).removeAttr("hidden"))),$panel.removeAttr("hidden");var $extended=$panel.closest(".juntaplay-group-card__details-extended");$extended.length&&($extended.removeAttr("hidden"),$extended.closest(".juntaplay-group-card").addClass("is-expanded"))}function renderError($card,message){var $panel=$card.find("[data-group-access-panel]").first();if(!$panel.length)return;var $hint=$panel.find("[data-group-access-hint]").first();$hint.length&&$hint.text(message||__("Não foi possível recuperar os dados de acesso agora. Tente novamente em instantes.")).removeAttr("hidden"),$panel.removeAttr("hidden")}$(document).on("click","[data-group-access]",function(event){event.preventDefault();var $button=$(this);if($button.prop("disabled"))return;var groupId=parseInt($button.data("groupAccess"),10);if(!groupId||Number.isNaN(groupId))return;var endpoint=ajaxUrl();if(!endpoint)return;var nonce=ajaxNonce(),$card=$button.closest("[data-group-item]");$button.prop("disabled",!0).addClass("is-loading"),$.ajax({url:endpoint,method:"POST",dataType:"json",data:{action:"juntaplay_group_credentials",nonce:nonce,group_id:groupId}}).done(function(response){if(response&&response.success)return void renderCredentials($card,response.data||{});var message=response&&response.data&&response.data.message?response.data.message.toString():__("Não foi possível recuperar os dados de acesso agora. Tente novamente em instantes.");renderError($card,message)}).fail(function(xhr){var message=__("Não foi possível recuperar os dados de acesso agora. Tente novamente em instantes.");xhr&&xhr.responseJSON&&xhr.responseJSON.data&&xhr.responseJSON.data.message&&(message=xhr.responseJSON.data.message.toString()),renderError($card,message)}).always(function(){$button.prop("disabled",!1).removeClass("is-loading")})})}(jQuery);
