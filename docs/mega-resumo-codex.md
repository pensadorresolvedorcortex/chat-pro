# üöÄ Mega Resumo ‚Äì Academia da Comunica√ß√£o (para Codex)

## üéØ Objetivo

Criar um clone moderno do **QConcursos**, chamado **Academia da Comunica√ß√£o**, composto por:

* **App Mobile (Flutter 3)** para iOS/Android
* **Painel Web CMS (Strapi 5 + PostgreSQL + Redis)** para cadastrar e gerenciar quest√µes, filtros, simulados, cadernos, desafios, metas, cursos e assinaturas
* **Integra√ß√µes**: Firebase (notifica√ß√µes, analytics), Meilisearch (busca), Pix (pagamentos)
* **Design System**: SaaS clean, fluido, com cores institucionais

---

## üìà Status Atual

* **Progresso estimado para APK Android:** 45‚ÄØ%
* **Estrutura do reposit√≥rio:**
  * `docs/` ‚Äì contrato OpenAPI, seeds Pix e mega resumo
  * `web/` ‚Äì CMS Strapi 5 com configura√ß√µes iniciais (PostgreSQL, Redis, Meilisearch)
  * `flutter/` ‚Äì app Flutter 3 com tema, roteamento e telas base de onboarding/dashboard/paywall
* **Frentes ativas:** gera√ß√£o dos content-types Strapi, implementa√ß√£o das rotas Pix server-side, conectar as telas Flutter aos provedores reais e instrumentar m√©tricas.
* **Cobran√ßas Pix no CMS:** rotas `/assinaturas/pix/cobrancas` e `/assinaturas/pix/chave-principal` expostas com gera√ß√£o, consulta e atualiza√ß√£o de status integradas √†s novas cole√ß√µes de Assinaturas e Cobran√ßas Pix.
* **Home naveg√°vel:** a tela inicial replica o QConcursos com destaques de alunos, quick actions, m√©tricas semanais e cards conectados aos exemplos de usu√°rios (`docs/examples/usuarios.json`) e dashboard (`docs/examples/dashboard_home.json`).
* **Relat√≥rios e guias:** checklist de finaliza√ß√£o em [`docs/finalizacao-app.md`](./finalizacao-app.md), runbook operacional em [`docs/release-runbook.md`](./release-runbook.md) e relat√≥rio de status em [`docs/go-live-report.md`](./go-live-report.md).
* **Exemplos de seed:** JSONs prontos em `docs/examples` cobrindo planos, assinaturas, cobran√ßas Pix, usu√°rios, onboarding, perfil, configura√ß√µes, dashboard, quest√µes, resolu√ß√µes, filtros, cadernos, simulados, desafios, metas, cursos, lives, mentorias, biblioteca, notifica√ß√µes, NPS e suporte.
* **Sincronia app ‚Üî CMS:** relat√≥rio em [`docs/app-panel-sync-report.md`](./app-panel-sync-report.md) e script de valida√ß√£o `python scripts/validate_sync.py` garantem que usu√°rios, planos, assinaturas e cobran√ßas compartilham os mesmos IDs.
* **Monitoramento:** endpoint autenticado `/health` no Strapi exp√µe o estado do banco de dados, Redis e Meilisearch ‚Äî com estes servi√ßos desabilitados por padr√£o no `.env` local ‚Äî para checkers externos e alertas.

---

## ‚úÖ Checklist para concluir o app

> Consulte o guia completo em [`docs/finalizacao-app.md`](./finalizacao-app.md) para detalhamento das a√ß√µes e respons√°veis e o [runbook de lan√ßamento](./release-runbook.md) para a cad√™ncia operacional at√© o go-live.

### App mobile (Flutter)

* üöß Conectar o paywall ao backend Pix (atualmente somente mock com assets locais).
* üöß Implementar o cache offline de cobran√ßas e planos (Hive/Isar ainda n√£o configurados).
* üöß Configurar notifica√ß√µes push para Pix, mentorias e lives (Firebase Auth/FCM pendentes).
* üìä Instrumentar m√©tricas de convers√£o e falhas Pix nos pain√©is Firebase/Sentry.

### CMS / Backend (Strapi)

* üöß Criar content-types e cole√ß√µes (planos, assinaturas, cobran√ßas, desafios, mentorias) no Strapi.
* üöß Implementar servi√ßos Pix (`/assinaturas/pix/*`) com gera√ß√£o de cobran√ßa e chave principal.
* üöß Publicar webhooks Pix para atualiza√ß√£o de assinaturas e disparo de notifica√ß√µes.
* üìä Evoluir relat√≥rios anal√≠ticos e integra√ß√µes com Data Studio/Grafana.

### QA, Observabilidade e Lan√ßamento

* üöß Montar su√≠te de testes end-to-end para compra Pix, downgrade, expira√ß√£o e aprova√ß√£o gratuita.
* üöß Ativar monitoramento (Crashlytics, Sentry, logs Strapi) com alertas de QR Code e retries.
* üöß Preparar assets, pol√≠tica LGPD e FAQ Pix para submiss√£o na Play Store.
* üìä Planejar acompanhamento semanal de NPS e feedbacks de suporte.

### üöß Plano de ataque final (72h)

| Status | Entrega | Dono | Depend√™ncias |
| --- | --- | --- | --- |
| üöß Em andamento | Integra√ß√£o Pix no app (paywall, recibo, hist√≥rico) com fallback offline | Squad Flutter | Rotas `/assinaturas/pix/*`, exemplos em `docs/examples` |
| üöß Em andamento | Tela de aprova√ß√£o dos Planos Gr√°tis para Alunos + logs de auditoria | Time CMS/Strapi | Workflow publicado no ambiente admin + seeds de planos |
| ‚úÖ Conclu√≠do | Seeds Pix (planos, assinaturas, cobran√ßas) e payloads de mentoria/live | Backend | Merge nos ambientes de staging |
| üìä Monitorando | Observabilidade Pix (Crashlytics, Sentry/Strapi, alertas expirados) | Mobile + DevOps | Evento de webhook `pix.cobranca.expirada` documentado |
| üöß Em andamento | Testes end-to-end automatizados (pagamento, downgrade, aprova√ß√£o gratuita) | QA | Dados seed + mocks Pix homologa√ß√£o |
| üöß Em andamento | Checklist de publica√ß√£o Android (assets, pol√≠tica, revis√£o LGPD) | PM | Aprova√ß√£o legal e marketing |

> Sempre sincronizar status no stand-up di√°rio e atualizar o `x-projectStatus` ap√≥s cada marco acima.

---

## üé® Identidade Visual

Paleta de cores oficial:

* **Prim√°ria:** `#6645f6`
* **Secund√°ria:** `#1dd3c4`
* **Terci√°ria:** `#e5be49`
* **Quatern√°ria (erro):** `#df5354`
* **Preto institucional:** `#0c3c64`
* **Neutros:** derivados (cinza 50‚Äì700)

Dark Mode ‚Üí base em `#0c3c64`, bot√µes e destaques em cores da paleta.

---

## üì± App Mobile (Flutter)

* Flutter 3 + Dart
* Arquitetura: Clean Architecture + Riverpod
* Roteamento: go_router
* Cache offline: Hive/Isar
* Integra√ß√µes: Firebase Auth, FCM, Analytics, Pagamentos via Pix (copia e cola + QR Code)
* Design: Material 3, cantos arredondados, cards, anima√ß√µes leves

Fluxos principais (baseados nos prints):

1. **Onboarding** (escolha de objetivo: concurso, explorar, estudar livre)
2. **Quest√µes** (resolver, comentar, favoritar, revisar, feedback imediato de certo/errado)
3. **Filtros** (simples, avan√ßados, salvos, baixados)
4. **Cadernos** (criar, gerenciar, offline)
5. **Simulados express** (wizard em 3 etapas: disciplinas, banca/dificuldade, tempo)
6. **Desempenho** (estat√≠sticas + ranking por per√≠odo)
7. **Desafios coletivos** (criar, participar, ranking de participantes)
8. **Metas de estudo** (quest√µes, horas, rendimento, progresso gamificado)
9. **Cursos/Aulas** (top em alta, recomendados, busca)
10. **Assinaturas** (planos mensal/anual, b√°sico/avan√ßado, paywall integrado)
11. **Perfil/Configura√ß√µes** (dark mode, suporte, termos, pol√≠tica)
12. **Suporte/NPS** (chat de ajuda, pesquisas de satisfa√ß√£o)
13. **Mentorias guiadas** (slots, reservas com tutores e acompanhamento p√≥s-sess√£o)
14. **Lives e eventos s√≠ncronos** (agenda centralizada, inscri√ß√µes, replays)

> Exemplos para cada fluxo: consulte `docs/examples/onboarding.json`, `usuarios.json`, `dashboard_home.json`, `perfil.json`, `configuracoes.json`, `questoes.json`, `cadernos.json`, `simulados.json`, `desafios.json`, `metas.json`, `cursos.json`, `lives.json`, `mentorias.json`, `biblioteca.json`, `notificacoes.json`, `nps.json` e `suporte.json`.

---

## üåê Painel Web (CMS ‚Äì Strapi 5)

* Banco: PostgreSQL
* Cache: Redis
* Busca: Meilisearch/Elastic
* RBAC: Admin, Editor, Tutor, Suporte, Aluno
* Plugins customizados: Quest√µes, Simulados, Desafios, Cursos, Planos
* Painel tematizado com as cores do app

### Content Types

* **Disciplina**: nome, slug
* **Assunto**: nome, slug, disciplinaId, parentId
* **Banca**: nome, sigla
* **Cargo**: nome, √°rea, n√≠vel
* **Concurso**: √≥rg√£o, UF, bancaId, cargos[], dataProva, temporada
* **Quest√£o**: enunciado (MD/HTML), alternativas A‚ÄìE, correta, explica√ß√£o, dificuldade, ano, disciplinaId, assuntoIds, bancaId, concursoId?, tags, m√≠dia, estat√≠sticas
* **FiltroSalvo**: userId, nome, queryJson
* **Caderno**: userId, t√≠tulo, quest√£oIds[]
* **Simulado**: tipo (express/manual), distribui√ß√£o, dificuldade, banca, nQuestoes, tempo, quest√£oIds[], resultados
* **Resolu√ß√£oQuest√£o**: userId, questaoId, simuladoId?, status, tempoSegundos
* **Desafio**: nome, dura√ß√£o, organizadorId, regras, status, participantes, ranking
* **MetaEstudo**: userId, tipo (horas/quest√µes/acertos/rendimento), alvo, janela, progresso
* **Curso**: t√≠tulo, descri√ß√£o, tags, destaque
* **Aula**: cursoId, t√≠tulo, tipo (v√≠deo/pdf), url, dura√ß√£o, anexos
* **Plano**: nome, periodicidade, pre√ßo, benef√≠cios, `chavePix`, tipo (pago ou gratis_aluno), aprovadoEm?, aprovadoPor?
* **Assinatura**: userId, planoId, metodoPagamento (pix|gratis_aluno), status, in√≠cio/fim, cobrancaPixId?, codigoCopiaCola, qrCodeUrl/base64, expiracaoPagamento
* **Notifica√ß√£o/NPS**: t√≠tulo, mensagem, tipo (promo/nps/sistema), agendamento, p√∫blico-alvo
* **Mentoria**: t√≠tulo, descri√ß√£o, mentorId, modalidade, dura√ß√£o, status, tags
* **MentoriaSlot**: mentoriaId, in√≠cio, fim, capacidade, status
* **MentoriaAgendamento**: mentoriaId, slotId, userId, status, notas
* **LiveEvento**: t√≠tulo, descri√ß√£o, apresentador, in√≠cio/fim, links, status, capacidade, tags
* **LiveInscricao**: liveId, userId, status, timestamps
* **MaterialBiblioteca**: t√≠tulo, descri√ß√£o, formato, arquivo/link, disciplinas, assuntos, tags, destaque, publicadoEm, m√©tricas

### Planos e Assinaturas

* **Planos pagos** (mensal, trimestral, anual) ficam dispon√≠veis imediatamente ap√≥s a cria√ß√£o, com cobran√ßa via Pix usando chave dedicada.
* **Planos Gr√°tis para Alunos** iniciam como `pendente` e s√≥ aparecem no app depois da aprova√ß√£o manual do super admin (auditoria com timestamp e respons√°vel).
* Cada plano guarda `chavePix` e benef√≠cios ativos, exibidos no dashboard e usados nas cobran√ßas.
* O dashboard administrativo permite editar valores e benef√≠cios, mantendo hist√≥rico de ajustes com respons√°vel, motivo, timestamps e diff de pre√ßos.
* Rotas-chave: `/planos/{id}/preco` para ajustes r√°pidos, `/planos/{id}/aprovar` para liberar Planos Gr√°tis para Alunos e `/assinaturas/pix/cobrancas` para emitir c√≥digos copia e cola com QR din√¢mico.
* Cada cobran√ßa Pix gera `codigoCopiaCola`, `qrCodeUrl`/`qrCodeBase64`, metadados do pagador e status em tempo real para sincronizar app e CMS.

### Rotas REST /qc/v1

* Cat√°logos: `/catalogos`
* Quest√µes: `/questoes`, `/questoes/import`
* Filtros: `/filtros`
* Cadernos: `/cadernos`
* Simulados: `/simulados/gerar`, `/simulados/:id/responder`
* Desafios: `/desafios`, `/desafios/:id/ranking`
* Metas: `/metas`
* Cursos/Aulas: `/cursos`
* Planos/Assinaturas: `/planos`, `/planos/{id}/preco`, `/planos/{id}/aprovar`, `/assinaturas/minha`, `/assinaturas/pix/cobrancas`, `/assinaturas/pix/cobrancas/{cobrancaId}`, `/assinaturas/pix/chave-principal`
* Mentorias: `/mentorias`
* Agenda de lives: `/agenda/lives`
* Biblioteca: `/biblioteca/materiais`
* Notifica√ß√µes: `/notificacoes/enviar`

---

## üîî Integra√ß√µes

* **Firebase Cloud Messaging (FCM)** ‚Üí push notifications
* **Pix** ‚Üí cobran√ßas instant√¢neas com c√≥digo copia e cola e QR Code din√¢mico
* **Cron Jobs** ‚Üí ranking di√°rio, estat√≠sticas agregadas

---

## üìä Prints de refer√™ncia

Os prints completos enviados nesta conversa ilustram todos os fluxos:

* Quest√µes, filtros, simulados, cadernos, desafios, cursos, planos de assinatura, desempenho, metas de estudo, onboarding, suporte, dark mode.
* **Links (internos desta conversa)**:

  * [Primeira remessa de prints](#)
  * [Segunda remessa](#)
  * [Terceira remessa](#)
  * [√öltima remessa](#)

> ‚ö†Ô∏è No ambiente Codex, insira os prints manualmente ou cole as imagens no mesmo prompt, pois ele n√£o tem acesso a links externos desta conversa.

---

## ‚úÖ Tarefas iniciais para Codex

1. **Gerar scaffold Strapi 5** com PostgreSQL, Redis, Meilisearch, RBAC
2. **Criar Content Types** listados acima
3. **Implementar rotas REST /qc/v1** conforme descrito
4. **Tema do painel** com as cores do app
5. **Seed inicial**: 3 disciplinas, 10 assuntos, 2 bancas, 50 quest√µes dummy, 2 cursos com 4 aulas
6. **Setup Mobile Flutter** com ThemeData e rota inicial
7. **Configurar m√≥dulos de mentorias, lives e biblioteca** com content types, rotas REST e exemplos no CMS
8. **Implementar fluxos Pix** com gera√ß√£o de cobran√ßas (c√≥digo copia e cola + QR), aprova√ß√£o de Planos Gr√°tis para Alunos e hist√≥rico de ajustes no dashboard

9. **Popular payloads de exemplo** abaixo no seed inicial para garantir paridade com as telas dos prints

---

## üß≠ Checklist de finaliza√ß√£o do app

### Mobile (Flutter)

* Implementar o fluxo completo de cobran√ßa Pix in-app (gerar cobran√ßa, polling do status, exibir QR/copia e cola e confirmar matr√≠cula).
* Conectar telas de Planos/Assinaturas aos endpoints `/planos`, `/planos/{id}/preco`, `/planos/{id}/aprovar` e `/assinaturas/pix/cobrancas` com estados de carregamento e erros.
* Finalizar integra√ß√µes de notifica√ß√µes (push + in-app) para confirma√ß√µes de pagamento, metas atingidas e eventos de mentorias/lives.
* Ajustar as telas de desempenho e ranking para consumirem os relat√≥rios consolidados da API e permitir filtros por per√≠odo.
* Concluir o modo offline (Hive/Isar) para cadernos e quest√µes salvas, incluindo sincroniza√ß√£o bidirecional.

### Backend / CMS (Strapi)

* Publicar workflows de aprova√ß√£o para Planos Gr√°tis para Alunos com hist√≥rico e notifica√ß√£o autom√°tica para o app.
* Garantir que o plugin Pix gerencie a emiss√£o de cobran√ßas, callbacks de status e arquivamento das cobran√ßas expiradas.
* Revisar RBAC e permiss√µes finas (admin, editor, tutor, suporte, aluno) cobrindo mentorias, lives, biblioteca e relat√≥rios.
* Configurar jobs ass√≠ncronos para atualizar rankings de desafios, m√©tricas de metas e expira√ß√£o de cobran√ßas Pix.
* Indexar conte√∫dos chave (quest√µes, cursos, biblioteca) no Meilisearch com sincronia incremental.
* Publicar o endpoint `/assinaturas/pix/chave-principal` no CMS para facilitar c√≥pia da chave Pix com QR embutido.

### QA, Analytics e Publica√ß√£o

* Executar testes end-to-end (mobile + backend) cobrindo onboarding, resolu√ß√£o de quest√µes, assinatura via Pix e participa√ß√£o em mentorias/lives.
* Configurar monitoramento no Firebase Analytics com eventos para Pix, desafios, metas e NPS.
* Preparar checklists de revis√£o visual (tema claro/escuro) e acessibilidade antes do build final.
* Automatizar gera√ß√£o do APK/Bundle com fastlane ou CI, incluindo vari√°veis de ambiente para endpoints e chaves Pix.
* Validar os webhooks Pix em ambiente de staging e documentar o procedimento de conting√™ncia.

> Cumprindo os itens acima, o app estar√° pronto para gerar o APK Android e seguir para homologa√ß√£o.

---

## üßæ Exemplos de Payloads para o Seed Inicial

```json
{
  "questao": {
    "id": "qst-2024-0001",
    "enunciado": "No contexto das campanhas de comunica√ß√£o, qual etapa garante o alinhamento entre mensagem e p√∫blico-alvo?",
    "alternativas": [
      "A) Defini√ß√£o de KPIs",
      "B) Pesquisa de persona",
      "C) Cria√ß√£o de pe√ßas",
      "D) Distribui√ß√£o de m√≠dia",
      "E) Monitoramento de m√©tricas"
    ],
    "correta": "B",
    "explicacao": "A pesquisa de persona determina necessidades e linguagem do p√∫blico, guiando toda a campanha.",
    "disciplina": "Planejamento de Comunica√ß√£o",
    "assuntos": ["Segmenta√ß√£o", "Brand Voice"],
    "banca": "ESPCOM",
    "ano": 2024,
    "dificuldade": "intermediaria",
    "estatisticas": {
      "taxaAcerto": 0.64,
      "respondida": 1820,
      "favoritos": 312
    }
  },
  "resposta": {
    "usuarioId": "usr-8841",
    "questaoId": "qst-2024-0001",
    "alternativa": "B",
    "correta": true,
    "tempoSegundos": 73,
    "comentario": "Mapeamento das personas impactou diretamente nossa escolha de canais.",
    "registradoEm": "2024-06-14T12:47:03Z"
  }
}
```

```json
{
  "planoPago": {
    "id": "pln-premium-anual",
    "nome": "Premium Anual",
    "periodicidade": "anual",
    "preco": 699.9,
    "moeda": "BRL",
    "beneficios": [
      "Quest√µes ilimitadas",
      "Simulados express e personalizados",
      "Relat√≥rios avan√ßados",
      "Mentorias coletivas mensais"
    ],
    "chavePix": "00020126360014BR.GOV.BCB.PIX0114academia@pix.com0208Academia5204000053039865802BR5917Academia Cursos6009SAO PAULO61080540900062070503***6304ABCD",
    "codigoCopiaCola": "00020101021226730014BR.GOV.BCB.PIX...",
    "qrCodeUrl": "https://cdn.academia/pix/premium-anual.png",
    "histPrecos": [
      {"valor": 649.9, "vigencia": "2023-11-01", "responsavel": "ana.costa"},
      {"valor": 699.9, "vigencia": "2024-05-10", "responsavel": "rafa.souza"}
    ]
  },
  "planoGratis": {
    "id": "pln-gratis-alunos",
    "nome": "Planos Gr√°tis para Alunos",
    "status": "pendente_aprovacao",
    "beneficios": [
      "Acesso a 30 quest√µes por dia",
      "2 simulados express por m√™s",
      "Estudo guiado inicial"
    ],
    "regras": "Dispon√≠vel para estudantes comprovando matr√≠cula ativa.",
    "aprovacao": {
      "solicitadoEm": "2024-06-12T14:20:00Z",
      "aprovadoEm": null,
      "aprovadoPor": null
    }
  }
}
```

---

## üì¶ Como usar este resumo

Cole este arquivo junto do `docs/openapi.yaml` quando for acionar o Codex. Ele fornece o panorama do produto, enquanto a especifica√ß√£o OpenAPI detalha os contratos das rotas. Combine ambos para gerar backend, CMS e app com mais contexto.

